---
title: vue3APIç†Ÿè¯»
date: 2022-04-21 00:00:00
sidebar: auto
sticky: false
permalink: /pages/vue220421/
categories: 
  - æ¡†æ¶
tags: 
  - vue

---

<p align="center">
  <img width="500" src="https://p18.qhimg.com/dmfd/2560_1440_/t01b2e930c2f1bcb2b9.jpg"/>
</p>



> å¾…å®Œå–„ï¼Œæ„Ÿè°¢æŒ‡æ•™ğŸ’•
> <!-- more -->

## vue3APIç†Ÿè¯»

### å…¨å±€API

- createSSRAPP

  > ä»¥SSRæ¿€æ´»æ¨¡åˆ›å»ºä¸€ä¸ªåº”ç”¨å®ä¾‹ã€‚ ç”¨æ³•ä¸createAppï¼ˆï¼‰ ç›¸åŒ
  >
  > `ssr` æ¡†æ¶æ˜¯ä¸ºå‰ç«¯æ¡†æ¶åœ¨æœåŠ¡ç«¯æ¸²æŸ“çš„åœºæ™¯ä¸‹æ‰€æ‰“é€ çš„å¼€ç®±å³ç”¨çš„æœåŠ¡ç«¯æ¸²æŸ“æ¡†æ¶

- app.provide()

  > æä¾›ä¸€ä¸ªå€¼ï¼Œå¯ä»¥åœ¨åº”ç”¨ä¸­æ‰€æœ‰åä»£ç»„ä»¶æ³¨å…¥ä½¿ç”¨

  ```vue
  import { createApp } from 'vue'
  const app = createApp(/*...*/)
  app.provide('message', 'hello')
  
  // æŸä¸ªç»„ä»¶ä¸­
  export default {
  	inject: ['message'],
  	created() {
  		console.log(this.message) // 'hello'
  	}
  }
  ```

- app.mixin

  > Vue3 ä¸æ¨èï¼Œ é‡‡ç”¨ç»„åˆå¼å‡½æ•°æ¥æ›¿ä»£

- app.version

  > é’ˆå¯¹ä¸åŒçš„vueç‰ˆæœ¬ï¼Œåšå‡ºä¸åŒçš„å¤„ç†ï¼Œ æ’ä»¶ä¸­æ¯”è¾ƒå¤šç”¨

- app.config

  > æ¯ä¸ªåº”ç”¨å®ä¾‹éƒ½ä¼šæš´éœ²ä¸€ä¸ªconfing å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«äº†å¯¹è¿™ä¸ªåº”ç”¨çš„é…ç½®è®¾å®šï¼Œå¯ä»¥å†æŒ‚è½½åº”ç”¨å‰æ›´æ”¹è¿™äº›å±æ€§

  - app.config.errorHandler

    - æ¥æº
      1. ç»„ä»¶æ¸²æŸ“å™¨
      2. äº‹ä»¶å¤„ç†å™¨
      3. å£°æ˜å‘¨æœŸé’©å­
      4. setupï¼ˆï¼‰å‡½æ•°
      5. ä¾¦å¬å™¨
      6. è‡ªå®šä¹‰æŒ‡ä»¤é’©å­
      7. è¿‡æ¸¡é’©å­

    ```
    app.config.errorHandler = (err, instance, info) => {
    	// å¤„ç†é”™è¯¯ï¼Œä¾‹å¦‚ï¼š æŠ¥å‘Šç»™ä¸€ä¸ªæœåŠ¡
    }
    ```

  - app.config.warnHandler

    > è­¦å‘Šï¼Œåªå­˜åœ¨å¼€å‘ç¯å¢ƒ

  - app.config.performance

    > ç±»å‹ï¼š bool
    >
    > æ˜¯å¦æ”¯æŒå¸¦æœ‰ `Performance insights`ï¼ˆæ€§èƒ½æ´å¯Ÿï¼‰ çš„æµè§ˆå™¨

  - app.config.compilerOptions

    > é…ç½®ç¼–è¯‘é€‰é¡¹

    [compilerOptions](https://staging-cn.vuejs.org/api/application.html#app-config-compileroptions)

  - **app.config.globalProperties**

    > åŸå‹æ›´æ”¹

  - app.config.optionMergeStrategies

    > è‡ªå®šä¹‰åˆå¹¶ç­–ç•¥ï¼ˆæ¯”å¦‚ä¹‹å‰çš„mixinsï¼‰

- nextTick()

  > [nextTick](https://staging-cn.vuejs.org/api/general.html#nexttick)

- [defineComponent()](https://staging-cn.vuejs.org/api/general.html#definecomponent)

- [defineAsyncComponent()](https://staging-cn.vuejs.org/api/general.html#defineasynccomponent)

- [defineCustomElement()](https://staging-cn.vuejs.org/api/general.html#definecustomelement)

### å†…ç½®æŒ‡ä»¤

- v-memo

  - åœºæ™¯

    ç”¨äº**æ€§èƒ½è‡³ä¸Š**åœºæ™¯ä¸­çš„å¾®å°ä¼˜åŒ–ï¼Œæœ‰åŠ©äºæ¸²æŸ“æµ·é‡ `v-for` åˆ—è¡¨ ï¼ˆå½“ length > 1000ï¼‰

  - æ¼”ç¤º

    ```
    <div v-for="item in list" :key="item.id" v-memo="[item.id === selected]">
      <p>ID: {{ item.id }} - selected: {{ item.id === selected }}</p>
      <p>...more child nodes</p>
    </div
    ```

    å½“ç»„ä»¶çš„ `selected` çŠ¶æ€æ”¹å˜ï¼Œå¤§é‡çš„ vnode å°†ä¼šè¢«åˆ›å»ºï¼Œå°½ç®¡å¤§éƒ¨åˆ†é¡¹éƒ½æ˜¯å®Œå…¨ä¸€è‡´ã€‚`v-memo` ç”¨åœ¨è¿™é‡Œæœ¬è´¨ä¸Šæ˜¯åœ¨è¯´â€œåªæœ‰ä»æœªé€‰ä¸­å˜ä¸ºé€‰ä¸­æˆ–è€…ç›¸åè½¬å˜æ—¶æ‰æ›´æ–°â€ã€‚è¿™ä½¿å¾—æ¯ä¸ªæœªå—å½±å“çš„é¡¹èƒ½é‡ç”¨ä¹‹å‰çš„ vnode å¹¶å®Œå…¨è·³è¿‡å·®å¼‚æ¯”è¾ƒã€‚æ³¨æ„è¿™é‡Œæˆ‘ä»¬å¹¶ä¸éœ€è¦åŒ…å« `item.id` åœ¨ memo ä¾èµ–æ•°ç»„ä¸­ï¼Œå› ä¸º Vue ä¼šæ ¹æ® item çš„ `:key` è¿›è¡Œæ¨æ–­ã€‚

  

### æŒ‡å—

#### æ¨¡æ¿è¯­æ³•

åŸºäºHTMLçš„æ¨¡æ¿è¯­æ³•ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿå£°æ˜å¼åœ°å°†ç»„ä»¶å®ä¾‹çš„æ•°æ®ç»‘å®šåˆ°å‘ˆç°çš„DOMä¸Šï¼›çŠ¶æ€å˜æ›´æ—¶ï¼ŒVueèƒ½å¤Ÿæ™ºèƒ½åœ°æ¨å¯¼å‡ºéœ€è¦é‡æ–°æ¸²æŸ“çš„ç»„ä»¶çš„æœ€å°‘æ•°é‡ï¼Œå¹¶åº”ç”¨æœ€å°‘çš„DOMæ“ä½œ

#### script setup

ä¸ºäº†è§£å†³åœ¨ setup() å‡½æ•°ä¸­æ‰‹åŠ¨æš´éœ²çŠ¶æ€å’Œæ–¹æ³•å¯èƒ½éå¸¸ç¹ç

#### reactive() çš„å±€é™æ€§

1. ä»…å¯¹å¯¹è±¡ç±»å‹æœ‰æ•ˆï¼ˆå¯¹è±¡ï¼Œæ•°ç»„ï¼Œmapã€setã€è¿™æ ·çš„ç»“åˆç±»å‹ï¼‰ï¼Œå¯¹stringã€numberã€booleanç±»å‹æ— æ•ˆ

2. é€šè¿‡propertyè¿›è¡Œè®¿é—®è¿½è¸ªçš„ï¼Œä¸å¯â€œéšæ„çš„æ›¿æ¢â€ä¸€ä¸ªå“åº”å¼å¯¹è±¡ï¼Œå¯èƒ½å¯¼è‡´å“åº”å¼é“¾æ¥ä¸¢å¤±

   ```javascript
   let state = reactive({ count: 0 })
   // åœºæ™¯1
   state = reactive({count: 1})
   
   // åœºæ™¯2
   let n = state.count
   n++
   
   // åœºæ™¯3
   let {count} = state
   count++
   
   // åœºæ™¯4
   callSomeFunction(state.count)
   ```

#### è®¡ç®—å±æ€§

1. è®¡ç®—å±æ€§

   ```javascript
   const publishedBooksMessage = computed(() => {
   	return author.books.length > 0 ? 'yes' : 'No'
   })
   ```

   > è¿”å›å€¼ä¸ºä¸€ä¸ªè®¡ç®—å±æ€§ref

2. è®¡ç®—å±æ€§ VS æ–¹æ³•

   è®¡ç®—å±æ€§å€¼ä¼šåŸºäºå…¶å“åº”å¼ä¾èµ–è¢«ç¼“å­˜

   æ–¹æ³•è°ƒç”¨ **æ€»æ˜¯**ä¼šåœ¨æ¸²æŸ“å‘ç”Ÿæ—¶å†æ¬¡æ‰§è¡Œå‡½æ•°

3. æœ€ä½³å®è·µ

   - è®¡ç®—å±æ€§ä¸åº”æœ‰å‰¯ä½œç”¨

     è®¡ç®—å‡½æ•°çš„èŒè´£ä»…ä¸ºè®¡ç®—å’Œè¿”å›å€¼ï¼ˆä¸è¦å†è®¡ç®—å‡½æ•°ä¸­åšå¼‚æ­¥è¯·æ±‚æˆ–è€…æ›´æ”¹DOMï¼‰

     æ ¹æ®å…¶ä»–å€¼æ´¾ç”Ÿä¸€ä¸ªå€¼

   - é¿å…ç›´æ¥ä¿®æ”¹è®¡ç®—å±æ€§

     ä¸´æ—¶å¿«ç…§

#### ç±»ä¸æ ·å¼ç»‘å®š

1. å’Œç»„ä»¶é…åˆ

   > V3å·²å»é™¤æ ¹ç»„ä»¶æ ‡ç­¾ï¼Œæ‰€ä»¥æ–°çš„ç»„ä»¶å¯ä»¥æœ‰å¤šä¸ªæ ¹æ ‡ç­¾

   - æœ‰ä¸€ä¸ªæ ¹æ ‡ç­¾

     ```html
     // çˆ¶ç»„ä»¶
     <my-component class="baz boo"></my-component>
     // å­ç»„ä»¶
     <p class="foo bar">Hi!</p>
     
     
     // æ¸²æŸ“å‡ºæ¥çš„html
     <p class="foo bar baz boo">Hi!</p>
     ```

   - æœ‰å¤šä¸ªæ ¹æ ‡ç­¾

     é€šè¿‡ `$attrs` propertyæ¥å®ç°æŒ‡å®š

     ```html
     // çˆ¶ç»„ä»¶
     <my-component class="baz"></my-component>
     // å­ç»„ä»¶
     <p class="$attrs.class">Hi!</p>
     <span>This is a child component</span>
     
     
     // æ¸²æŸ“å‡ºæ¥çš„html
     <p class="baz">Hi!</p>
     <span>This is a child component</span>
     ```


#### åˆ—è¡¨æ¸²æŸ“

1. ä½¿ç”¨ç»“æ„èµ‹å€¼

   ```html
   <li v-for="{message} in items">
   	{{ message }}
   </li>
   
   // æœ‰indexç´¢å¼•æ—¶
   <li v-for="({message}, index) in items">
   	{{ message }} {{ index }}
   </li>
   ```

2. ä¹Ÿå¯ä»¥ä½¿ç”¨ `of` æ¥ä½œä¸ºåˆ†éš”ç¬¦ä»£æ›¿ `in`, è¿™å’Œ JavaScript çš„è¿­ä»£å™¨è¯­æ³•éå¸¸ç›¸ä¼¼

   ```html
   <div v-for="item of items"></div>
   ```

3. **v-for ä¸ v-if ä¼˜å…ˆçº§**

   > æˆ‘ä»¬ä¸æ¨èåœ¨åŒä¸€å…ƒç´ ä¸Šä½¿ç”¨ `v-if`  å’Œ `v-for`

   - `V2`ç‰ˆæœ¬

     ```html
     // å¤„äºåŒä¸€èŠ‚ç‚¹æ—¶ï¼Œv-forçš„ä¼˜å…ˆçº§æ¯”v-if æ›´é«˜
     
     // ä¼˜åŒ–
     <template v-if="todos.length">
         <li v-for="todo in todos">
         	{{ todo }}
         </li>
     </template>
     <template v-else>No todos lefts!</template>
     ```

   - `V3`ç‰ˆæœ¬

     ```html
     // å¤„äºåŒä¸€èŠ‚ç‚¹æ—¶ï¼Œv-ifæ¯”v-forçš„ä¼˜å…ˆçº§æ›´é«˜ï¼Œv-ifçš„æ¡ä»¶å°†æ— æ³•è®¿é—®åˆ° v-forä½œç”¨åŸŸå†…å®šä¹‰çš„å˜é‡åˆ«å
     <li v-for="todo in todos" v-if="!todo.isCoplete">
     	{{ to.name }}
     </li>
     // æŠ›å‡ºé”™è¯¯ï¼Œå±æ€§todoæ²¡æœ‰åœ¨è¯¥å®ä¾‹ä¸Šå®šä¹‰
     
     <template v-for="todo in todos">
     	<li v-if="!todo.isComplete">
         	{{ todo.name }}
         </li>
     </template>
     ```

4. é€šè¿‡keyç®¡ç†çŠ¶æ€

   - æœ€é«˜æ•ˆ

     åªé€‚ç”¨äºåˆ—è¡¨æ¸²æŸ“è¾“å‡ºï¼Œ**ä¸ä¾èµ–å­ç»„ä»¶çŠ¶æ€æˆ–è€…ä¸´æ—¶DOMçŠ¶æ€**ï¼ˆä¾‹å¦‚è¡¨å•è¾“å…¥å€¼ï¼‰

   - æ¨è

     åœ¨ä»»ä½•å¯è¡Œçš„æ—¶å€™ä¸º `v-for`æä¾›ä¸€ä¸ª`key` attribute, é™¤éæ‰€è¿­ä»£çš„DOMå†…å®¹éå¸¸ç®€å•ï¼›æœ‰æ„ä¾èµ–é»˜è®¤è¡Œä¸ºè·å¾—æ€§èƒ½å¢ç›Š

5. ç»„ä»¶ä¸Šä½¿ç”¨ `v-for`

   ```
   // å¯ä»¥ç›´æ¥åœ¨ç»„ä»¶ä¸Šä½¿ç”¨ v-for, å’Œå…¶ä»–ä»»ä½•ä¸€èˆ¬çš„å…ƒç´ æ²¡æœ‰åŒºåˆ«ï¼ˆåˆ«å¿˜è®°æä¾›ä¸€ä¸ªkeyï¼‰
   // å› ä¸ºç»„ä»¶æœ‰è‡ªå·±ç‹¬ç«‹çš„ä½œç”¨åŸŸã€‚ä¸ºäº†å°†è¿­ä»£åçš„æ•°æ®ä¼ é€’åˆ°ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬è¿˜æ˜¯åº”è¯¥ä½¿ç”¨propï¼š
   ```

6. æ•°ç»„å˜åŒ–ä¾¦æµ‹

   - å˜æ›´æ–¹æ³•

     7ä¸ªï¼Œå¯¹åŸæœ‰æ•°ç»„è¿›è¡Œå˜æ›´ï¼Œæ”¹å˜åŸæ•°ç»„

   - éå˜æ›´æ–¹æ³•

     ä¸æ”¹å˜åŸæ•°ç»„ï¼Œè¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼›å°†æ—§çš„æ•°ç»„æ›¿æ¢ä¸ºæ–°çš„

7. å±•ç¤ºè¿‡æ»¤æˆ–æ’åºåçš„ç»“æœ

   > åœ¨è®¡ç®—å±æ€§ä¸­ä½¿ç”¨ `reverse()` å’Œ `sort()` è¯·ä¿æŒè°¨æ…ï¼è¿™ä¸¤ä¸ªæ–¹æ³•å°†å˜æ›´åŸå§‹æ•°ç»„ï¼Œè®¡ç®—å‡½æ•°ä¸­ä¸åº”è¯¥é‚£ä¹ˆåš

   ```javascript
   // è¯·åœ¨è°ƒç”¨è¿™äº›æ–¹æ³•ä¹‹å‰åˆ›å»ºä¸€ä¸ªåŸæ•°ç»„çš„å‰¯æœ¬
   
   - return numbers.reverse()
   + retrun [...numbers].reverse()
   ```

#### äº‹ä»¶å¤„ç†

1. ç›‘å¬äº‹ä»¶

   - å†…è”äº‹ä»¶å¤„ç†å™¨

     > å¤„ç†ç®€å•åœºæ™¯

     ```javascript
     const count = ref(0)
     // template
     <button @click="count++">Add 1</button>
     ```

     ```html
     <script setup>
     function greet(e, str) {
         console.log(e, str)
         // PointerEvent {...}   'hello'
     }
     </script>
     
     <template>
     	<button @click="greet($event, 'hello')"></button>
     </template>
     ```

   - æ–¹æ³•äº‹ä»¶å¤„ç†å™¨

     > **éœ€è¦ä½¿ç”¨é»˜è®¤å€¼å’Œæ‰‹åŠ¨ä¼ å‚ä¸€åŒä½¿ç”¨æ—¶**

     ```html
     <script setup>
     function greet(event) {
         console.log(e, str)
         // PointerEvent {...}   'hello'
     }
     </script>
     
     <template>
     	<button @click="greet"></button>
     </template>
     ```

   |   äº‹ä»¶   |             æ¡ˆä¾‹             |
   | :------: | :--------------------------: |
   | å†…è”äº‹ä»¶ | foo() :æºå¸¦æ‹¬å·      count++ |
   | æ–¹æ³•äº‹ä»¶ |   fooã€foo.barã€foo['bar']   |

2. äº‹ä»¶ä¿®é¥°ç¬¦

   > ä¸“æ³¨äºæ•°æ®é€»è¾‘è€Œä¸ç”¨å¤„ç†DOMäº‹ä»¶çš„ç»†èŠ‚

   ```
   stop
   prevent
   self
   capture
   once
   passive
   // å¯ä»¥é“¾å¼è°ƒç”¨ï¼Œ æ³¨æ„å‰åé¡ºåº
   ```

3. æŒ‰é”®ä¿®é¥°ç¬¦

4. é¼ æ ‡æŒ‰é”®ä¿®é¥°ç¬¦

#### è¡¨å•è¾“å…¥ç»‘å®š

> èƒŒæ™¯ï¼š åœ¨å‰ç«¯å¤„ç†è¡¨å•æ—¶ï¼Œæˆ‘ä»¬å¸¸å¸¸éœ€è¦å°†è¡¨å•è¾“å…¥æ¡†çš„å†…å®¹åŒæ­¥ç»™JavaScript ä¸­å“åº”çš„å˜é‡ã€‚æ‰‹åŠ¨è¿æ¥å€¼ç»‘å®šå’Œæ›´æ”¹äº‹ä»¶ç›‘å¬å™¨å¯èƒ½ä¼šå¾ˆéº»çƒ¦

```html
<input :value="text" @input="event => text = event.target.value">
```

- vue**æ™ºèƒ½çš„å¤„ç†ä¸‰ç±»ä¸åŒç±»å‹**çš„è¾“å…¥

  1. æ–‡æœ¬ç±»å‹çš„ `input` å’Œ `textarea`  ä½¿ç”¨ `value` å±æ€§å’Œ`input`äº‹ä»¶
  2. `<input type="checkbox">` å’Œ`<input type="radio">`  ä½¿ç”¨ `checked`å’Œ `change`äº‹ä»¶
  3. `<select>`ä½¿ç”¨ `value`ä½œä¸ºpropï¼Œ `change`ä½œä¸ºäº‹ä»¶

- ä¿®é¥°ç¬¦

  ```
  .lazy // changeäº‹ä»¶åæ›´æ–°æ•°æ®
  .number
  .trim
  ```

- ç»„ä»¶ä¸Šçš„ `v-model`

#### å£°å‘½å‘¨æœŸ

> æ¯ä¸€ä¸ªç»„ä»¶å®ä¾‹åœ¨åˆ›å»ºæ—¶ç»å†çš„ä¸€äº›åˆå§‹åŒ–æ­¥éª¤

- æ•°æ®åŠ«æŒ - æ•°æ®ä¾¦å¬
- ç¼–è¯‘æ¨¡æ¿
- æŒ‚è½½å®ä¾‹åˆ°DOM
- æ•°æ®å˜åŒ–æ—¶æ›´æ–°DOM

åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œä¹Ÿä¼šæ‰§è¡Œä¸€äº›ç§°ä¸ºç”Ÿå‘½é’©å­çš„å‡½æ•°ï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿåœ¨ç‰¹å®šçš„é˜¶æ®µæ·»åŠ è‡ªå·±çš„ä»£ç 

#### ä¾¦å¬å™¨

> åº”å¯¹ä¸€äº›çŠ¶æ€çš„å˜åŒ–ï¼Œæˆ‘ä»¬éœ€è¦è¿è¡Œå†™ â€œ**å‰¯ä½œç”¨**â€

- æ›´æ”¹DOM
- æ ¹æ®å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œå»ä¿®æ”¹å¦ä¸€å¤„çš„çŠ¶æ€
  - å®šæ—¶å™¨
  - å‘è¯·æ±‚

1. ä¾¦å¬æ¥æºç±»å‹ï¼ˆå¸¸ç”¨å‰ä¸¤ç§ï¼‰

   - ref (åŒ…æ‹¬è®¡ç®—å±æ€§)

     ```
     const x = ref(0)
     
     watch(x, (newX) => {
       console.log(`x is ${newX}`)
     })
     ```

   - reactive

     > ä½¿ç”¨getterå‡½æ•°æ¥å»ä¾¦å¬ reactiveå¯¹è±¡

     ```
     const obj = reactvie({count: 0})
     // ä»¥ä¸‹æ“ä½œä¸èµ·ä½œç”¨ï¼Œå› ä¸ºä½ å‘ watchï¼ˆï¼‰ä¼ å…¥äº†ä¸€ä¸ªnumber
     watch(obj.count, (count)=>{
     	console.log('xxx')
     })
     
     // æ­£ç¡®å†™æ³•
     watch(
     	() => obj.count,
     	(count) => {
     		console.log(xxx)
     	}
     )
     ```

   - getterå‡½æ•°

   - å¤šä¸ªæ¥æºç»„æˆçš„æ•°ç»„

2. watch å’Œ watchEffect çš„åŒºåˆ«

   - ä¸åŒç‚¹

     - ç›‘å¬å±æ€§ä¸ªæ•°

       watch ä¸€ä¸ªï¼ˆæ˜ç¡®æŒ‡å®šï¼‰

       watchEffect å¤šä¸ª  ï¼ˆåˆå§‹åŒ–æ‰§è¡Œä¸€æ¬¡ï¼Œå»æ”¶é›†ä¸‹è¦ç›‘å¬çš„æ˜¯å“ªå‡ ä¸ªï¼‰

     - åˆå§‹åŒ–æ˜¯å¦æ‰§è¡Œ

       watch (åªæœ‰è®¾ç½® immediate:true) ,åˆå§‹åŒ–æ‰ä¼šæ‰§è¡Œ **æ‡’æ‰§è¡Œ**

       watchEffectæ‰§è¡Œ

   - ç›¸åŒç‚¹

     åº”å¯¹ä¸€äº›çŠ¶æ€çš„å˜åŒ–ï¼Œè¿è¡Œä¸€äº› **å‰¯ä½œç”¨**

   - ç†è§£è¯

     **å‰¯ä½œç”¨ã€çº¯å‡½æ•°ã€ä¾èµ–è¿½è¸ª**

3. watchEffect ä½¿ç”¨åœºæ™¯

   ä¹‹å‰**éœ€è¦åˆå§‹åŒ–ç›‘å¬å±æ€§** çš„åœºæ™¯ï¼Œ å†™æ³•ä¸Šå¯ä»¥æ›´ä¼˜é›…ï¼Œç®€åŒ–ä»£ç 

4. å›è°ƒä¸­è§¦ç¢°DOM

   å¦‚æœæƒ³åœ¨ä¾¦å¬å™¨å›è°ƒä¸­èƒ½è®¿é—®è¢« Vue æ›´æ–°**ä¹‹å**çš„DOMï¼Œä½ éœ€è¦æŒ‡æ˜ `flush: 'post'` é€‰é¡¹ï¼š

   ```
   watch(source, callback, {
     flush: 'post'
   })
   
   watchEffect(callback, {
     flush: 'post'
   })
   ```

#### æ¨¡æ¿ref

1. åˆ›å»ºref

   > ä¸ºäº†é€šè¿‡ç»„åˆå¼APIè·å¾—è¯¥æ¨¡æ¿refï¼Œæˆ‘ä»¬éœ€è¦å£°æ˜ä¸€ä¸ª**åŒå**çš„refï¼š   

   ![img](https://staticqn.qizuang.com/custom/20220611/FhFM6lF8QSarKUxmubH8n0-Yenw-)

   > æ³¨æ„ï¼š åªå¯ä»¥åœ¨ç»„ä»¶æŒ‚è½½åæ‰èƒ½è®¿é—®ref

   ```
   watchEffect(()=>{
   	if(input.value) {
   		input.value.focus()
   	} else {
   		// æ­¤æ—¶è¿˜æœªæŒ‚è½½ï¼Œæˆ–æ­¤å…ƒç´ å·²ç»è¢«ååŠ©ï¼ˆä¾‹å¦‚é€šè¿‡v-ifæ§åˆ¶ï¼‰
   	}
   })
   ```

2. `v-for`ä¸­çš„ref

   > å½“ `ref` åœ¨ `v-for` ä¸­ä½¿ç”¨æ—¶ï¼Œç›¸åº”çš„refä¸­åŒ…å«çš„å€¼æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå®ƒå°†åœ¨å…ƒç´ æŒ‚è½½åå¡«å……

   ```html
   <script setup>
   	import { ref, onMounted } from 'vue'
       const list = ref([
           ...
       ])
       const itemRefs = ref([])
       onMounted(() => console.log(itemRefs.value))
   </script>
   <template>
   	<ul>
           <li v-for="item in list" ref="itemRefs">
           	{{ item }}
           </li>
       </ul>
   </template>
   ```

3. å‡½æ•°å‹ref

   ```
   <input :ref="(el) => {}">
   ```

4. ç»„ä»¶ä¸Šçš„ref

   > ä½¿ç”¨äº† `<script setup>`çš„ç»„ä»¶æ˜¯é»˜è®¤ç§æœ‰çš„ï¼š ä¸€ä¸ªçˆ¶ç»„ä»¶æ— æ³•è®¿é—®ä¸€ä¸ªä½¿ç”¨äº† `<script setup>`çš„ç»„ä»¶ä¸­ä»»ä½•ä¸œè¥¿ï¼Œé™¤éå­ç»„ä»¶åœ¨å…¶ä¸­é€šè¿‡ `defineExpose` **å®**æ˜¾ç¤ºæš´éœ²

   ```html
   <script setup>
   import { ref } from 'vue'
   const a = 1
   const b = ref(2)
   
   defineExpose({
       a,
       b
   })
   </script>
   ```

#### ç»„ä»¶åŸºç¡€

1. å®šä¹‰ä¸€ä¸ªç»„ä»¶

   - ä½¿ç”¨æ„å»ºæ­¥éª¤
   - ä¸ä½¿ç”¨æ„å»ºæ­¥éª¤

2. ä½¿ç”¨ç»„ä»¶

   ```html
   <script setup>
   import ButtonCounter from './ButtonCounter.vue'
   </script>
   
   <template>
   	<h1>Here is a child Component!</h1>
       <ButtonCounter/>
   </template>
   ```

3. ä¼ é€’props

   ```html
   <script setup>
   defineProps(['title'])
       
   // åŒæ ·å¯ä»¥åœ¨JavaScriptä¸­ä½¿ç”¨
   const props = defineProps(['title'])
   console.log(props.title)
   </script>
   <template>
   <h4>{{ title }}</h4>
   </template>
   ```

4. ç›‘å¬äº‹ä»¶

   - çˆ¶ç»„ä»¶

     ```html
     <script setup>
     import { ref } from 'vue'
     import BlogPost from './BlogPost.vue' 
     
     const posts = ref([
         {id:1, title: 'jack'},
         {id:2, title: 'boy'}
     ])    
     const postFontSize = ref(1)
     </script>
     
     <template>
         <div :style="{ fontSize: postFontSize + 'em' }">
         <BlogPost
           v-for="post in posts"
           :key="post.id"
           :title="post.title"
           @enlarge-text="postFontSize += 0.1"
         ></BlogPost>
       </div>
     </template> 
     ```

   - å­ç»„ä»¶

     ```html
     <script setup>
     defineProps(['title'])
     defineEmits(['enlarge-text'])
     </script>
     <template>
      <div class="blog-post">
         <h4>{{ title }}</h4>
         <button @click="$emit('enlarge-text')">Enlarge text</button>
       </div>
     </template>
     ```

5. æ’æ§½

   ```html
   // çˆ¶ç»„ä»¶
   <AlerBox>
   	Something bad happenend.
   </AlerBox>
   
   // å­ç»„ä»¶
   <template>
   	<div class="alert-box">
           <strong>this is an Error</strong>
           <slot/>
       </div>
   </template>
   ```

6. åŠ¨æ€ç»„ä»¶

   > é…åˆ `<KeepAlive>` ç»„ä»¶å¼ºåˆ¶ä¸æ´»è·ƒçš„ç»„ä»¶ä»ç„¶ä¿æŒâ€œå­˜æ´»â€ çš„çŠ¶æ€

   ```
   <component :is="..."> æ¥åœ¨å¤šä¸ªç»„ä»¶é—´ä½œåˆ‡æ¢æ—¶ï¼Œç»„ä»¶ä¼šåœ¨è¢«åˆ‡æ¢åå¸è½½ã€‚ä½¿ç”¨<KeepAlive>å­˜æ´»
   ```

7. **æ¨¡æ¿è§£ææ³¨æ„äº‹é¡¹**

   - å¤§å°å†™åŒºåˆ†

     > HTMLæ ‡ç­¾å’Œå±æ€§åç§°æ˜¯ä¸åˆ†å¤§å°å†™çš„ï¼Œæ‰€ä»¥æµè§ˆå™¨ä¼šæŠŠä»»ä½•å¤§å†™çš„å­—ç¬¦ä¸²è§£é‡Šä¸ºå°å†™ã€‚

     **ç»“è®ºï¼š æ— è®ºä»€ä¹ˆçš„ä¹¦å†™ï¼Œæœ€åè½¬åŒ–ä¸ºç­‰ä»·çš„ kebab-case (çŸ­æ¨ªçº¿è¿å­—ç¬¦)å½¢å¼**

     - é©¼å³°æ‹¼å†™æ³•ï¼ˆCamelCaseï¼‰

       |               é©¼å³°å‘½å               |    ä¸¾ä¾‹    |
       | :----------------------------------: | :--------: |
       | å¤§é©¼å³° - UpperCamelCase - PascalCase | BlackColor |
       |       å°é©¼å³° - lowerCamelCase        | blackColor |

     - çŸ­æ¨ªçº¿è¿å­—ç¬¦ï¼ˆkebab-caseï¼‰

   - é—­åˆæ ‡ç­¾

   - å…ƒç´ ä½ç½®é™åˆ¶

     | é™åˆ¶å…ƒç´ çˆ¶ | é™åˆ¶å…ƒç´ å­ |
     | :--------: | :--------: |
     | <ul>  <ol> |    <li>    |
     |  <table>   |    <tr>    |
     |  <select>  |  <option>  |

### æ·±å…¥ç»„ä»¶

#### æ³¨å†Œ

1. å…¨å±€æ³¨å†Œ

   ```
   import { createApp } from 'vue'
   const app = createApp({})
   app.component(
   	'MyComponent', {}
   )
   ```

   - æ»¥ç”¨å…¨å±€ç»„ä»¶ç¼ºç‚¹
     1. å¦‚æœä½ å…¨å±€æ³¨å†Œäº†ä¸€ä¸ªç»„ä»¶ï¼Œå´ä¸€æ¬¡æ²¡æœ‰ç”¨ï¼Œå®ƒä»ç„¶ä¼šå‡ºç°åœ¨æœ€ç»ˆçš„æ„å»ºäº§ç‰©ä¸­ ï¼ˆt**ree-shaking**å¤„ç†ä¸äº†ï¼‰
     2. æ˜¯é¡¹ç›®ä¸­çš„**ä¾èµ–å…³ç³»**å˜å¾—ä¸é‚£ä¹ˆæ˜ç¡®ã€‚åœ¨çˆ¶ç»„ä»¶ä¸­ä½¿ç”¨å­ç»„ä»¶æ—¶ï¼Œå¾ˆéš¾å®šä½å­ç»„ä»¶çš„å®ç°ã€‚ç±»ä¼¼ä½¿ç”¨äº†è¿‡å¤šçš„å…¨å±€å˜é‡

2. å±€éƒ¨æ³¨å†Œ

   - ä¾èµ–å…³ç³»æ˜ç¡®

   - å¯¹tree-shakingæ›´åŠ æ˜ç¡®

   - **æ— éœ€æ³¨å†Œ**

     å½“ä½¿ç”¨äº† `<script setup>` å¯¼å…¥çš„ç»„ä»¶å¯ä»¥åœ¨æœ¬åœ°ä½¿ç”¨æ— éœ€æ³¨å†Œ

3. **ç»„ä»¶åæ ¼å¼**ï¼ˆå¤§é©¼å³°ï¼‰

   > ä½¿ç”¨ PascalCaseä½œä¸ºç»„ä»¶åçš„æ³¨å†Œæ ¼å¼

   1. ä¹¦å†™å®¹æ˜“

   2. å†™æ ‡ç­¾æ—¶ï¼Œå¯ä»¥å†™å•æ ‡ç­¾

      å¦‚æœä¸ºçŸ­æ¨ªçº¿ï¼Œéœ€è¦å†™ä¸¤æ ‡ç­¾ï¼Œè¿›è¡Œé—­åˆ

   ```
   <MyComponent>   ä¸ <my-component> ç­‰ä»·
   ```

#### Props

1. Propå£°æ˜

   ```html
   <script setup>
   // æ¡ˆä¾‹ä¸€
   defineProps(['foo'])
   // æ¡ˆä¾‹äºŒ
   defineProps({
       title: String,
       likes: Number
   })
   </script>
   
   <script setup lang="ts">
   defineProps<{
       title?: string
       likes?: number
   }>()    
   </script>
   ```

2. ä¼ é€’ç»†èŠ‚

   > ä½¿ç”¨ camelCaseå½¢å¼

   - å®é™…ä¸ºäº†å’Œ `HTML attribute` å¯¹é½ï¼Œéƒ½ä¼šå°†å…¶è½¬ä¸º kebab-case å½¢å¼

   - é™æ€ VS åŠ¨æ€

     - é™æ€

       ä¸åŠ  `:`

     - åŠ¨æ€

       æ·»åŠ  `:`

   - ä¼ é€’ä¸åŒå€¼ç±»å‹

   - ä½¿ç”¨å¯¹è±¡ç»‘å®šå¤šä¸ªprop

     ```html
     const post = {
     	id: 1, 
     	title: 'My Journey with Vue'
     }
     
     // ä½¿ç”¨
     <BlogPost v-bind="post" />
     // ç­‰ä»·äº
     <BlogPost :id="post.id" :title="post.title"/>
     ```

3. å•é¡¹æ•°æ®æµ

   > prop æ˜¯åªè¯»çš„

   - æƒ³è¦æ›´æ”¹ prop

     ä½¿ç”¨æ–°å€¼æ¥æ¥æ”¶ä¸€ä¸‹ prop

     ```javascript
     // æ¡ˆä¾‹1
     const props = defineProps(['initialCounter'])
     const counter = ref(props.initialCounter)
     
     // æ¡ˆä¾‹2
     const props = defineProps(['size'])
     const normalizedSize = computed(()=> props.size.trim().tolowerCase())
     ```

   - æ›´æ”¹å¯¹è±¡ / æ•°ç»„ç±»å‹çš„prop

     **å¯ä»¥è¿›è¡Œæ›´æ”¹**

     åŸå› ï¼š å¯¹è±¡å’Œæ•°å­—æ˜¯æŒ‰å¼•ç”¨ä¼ é€’ï¼Œ å¯¹Vueæ¥è¯´ï¼Œé˜»æ­¢è¿™æ ·çš„æ”¹å˜éå¸¸æ˜‚è´µï¼Œä¹Ÿä¸åˆç†ï¼Œå¯¼è‡´æ•°æ®æ¨ç†éš¾ä»¥é¢„æ–™

     æ­£ç¡®å¤„ç†ï¼š æŠ›å‡ºæ—¶é—´é€šçŸ¥çˆ¶ç»„ä»¶æ”¹å˜

4. Propæ ¡éªŒ

   ```
   type
   required
   defalult
   validator
   ```

5. è¿è¡Œæ—¶ç±»å‹æ£€æŸ¥

   ```
   String
   Number
   Boolean
   Array
   Object
   Date
   Function
   Symbol
   ```

   > è¿˜å¯ä»¥æ˜¯è‡ªå·±è‡ªå®šä¹‰çš„ç±»å’Œæ„é€ å‡½æ•°ï¼Œå¯ä»¥é€šè¿‡ `instanceof` æ¥æ£€æŸ¥ï¼Œæ–­è¨€

   ```javascript
   class Person {
   	constructor(firstName, lastName) {
   		this.firstName = firstName
   		this.lastName = lastName
   	}
   }
   
   defineProps({
   	author: Person
   })
   ```

6. Boolean ç±»å‹è½¬æ¢

   å¯¹äºBoolean çš„æ¥å—

   ```javascript
   defineProps({
       disabled: [Boolean, Number]
   })
   ```

#### äº‹ä»¶

1. è§¦å‘ä¸ç›‘å¬äº‹ä»¶

   - ä½¿ç”¨`$emit` å‡½æ•°è§¦å‘è‡ªå®šä¹‰äº‹ä»¶

2. äº‹ä»¶å‚æ•°

   ```html
   <MyButton @increase-by="(n) => count += n"/>
   ```

3. å£°æ˜è§¦å‘çš„äº‹ä»¶

   - éœ€è¦defineEmits() å®æ¥å£°æ˜

     ```html
     <script setup>
     defineEmits(['inFocus', 'submit'])
     </script>
     ```

4. äº‹ä»¶æ ¡éªŒ

   ```html
   <script setup>
   	const emit = defineEmits({
           // æ²¡æœ‰æ ¡éªŒ
           click: null,
           // æ ¡éªŒ
           submit: ({email, password}) =>{
               if (email && password) {
                 return true
               } else {
                 console.warn('Invalid submit event payload!')
                 return false
               }
           }
       })
       fucntion submitForm(email, password) {
           emit('submit', { email, password })
       }
   </script>
   ```

5. **é…åˆ `v-model` ä½¿ç”¨**

   [v-model](https://staging-cn.vuejs.org/guide/components/events.html#usage-with-v-model)

   - å·²å®ç°å¤šä¸ª v-modelï¼Œ ç§»é™¤asyncè¯­æ³•ç³–

#### é€ä¼ Attribute

1. Attribute ç»§æ‰¿

   > æ²¡æœ‰æ˜¾ç¤ºåœ°å£°æ˜æ‰€æ¥æ”¶ç»„ä»¶çš„ `props` æˆ– `emits` ã€‚å¸¸è§ **class, style, id, v-onç›‘è§†å™¨**

2. å¯¹ `calss` å’Œ `style` çš„åˆå¹¶

3. `v-on` ç›‘å¬å™¨ç»§æ‰¿

   ç›‘å¬å™¨ `click` ä¼šè¢«æ·»åŠ åˆ° `<MyButton>` çš„æ ¹å…ƒç´ 

4. æ·±å±‚ç»„ä»¶ç»§æ‰¿ï¼ˆç†è§£ï¼‰

5. ç¦ç”¨Attributeç»§æ‰¿

   ç»„ä»¶é€‰ä¸­è®¾ç½® `inheritAttrs: false`

   ```javascript
   Vue.component('my-component', {
       inheritAttrs: false,
       ...
   })
   ```

   - æ³¨æ„
     - ä¸propsä¸åŒï¼Œé€ä¼ ä¼šç»§æ‰¿ä»–ä»¬**åŸå§‹å¤§å°å†™**
     - å‘`@click` è¿™æ ·ä¼šæš´éœ²ä¸ºä¸€ä¸ªå‡½æ•° `$attrs.onClick`

   **é€ä¼ æŒ‡å®šç»„ä»¶å†…å…ƒç´ (å¾…éªŒè¯)**

   ```javascript
   // å­ç»„ä»¶
   <div class="btn-wrapper">
     <button class="btn" v-bind="$attrs">click me</button>
   </div>
   ```

6. **å¤šæ ¹èŠ‚ç‚¹çš„Attributeç»§æ‰¿** 

   > æ³¨æ„ï¼š å¦‚æœå­˜åœ¨å¤šä¸ªæ ¹èŠ‚ç‚¹ï¼Œä½† `$attrs`æ²¡æœ‰æ˜¾ç¤ºç»‘å®šï¼Œåˆ™ä¼šæŠ›å‡ºé”™è¯¯

   ```html
   // çˆ¶ç»„ä»¶
   <CustomLayout id="custom-layout" @click="changeValue"/>
   
   // å­ç»„ä»¶
   <header>...</header>
   <main v-bind="$attrs">...</main>  // å¿…é¡»æœ‰ä¸€ä¸ªå…ƒç´ æ¥æ¥ $attrs
   <footer>...</footer>
   ```

#### æ’æ§½ ï¼ˆå¾…ç»ƒä¹ ï¼‰

> æ’æ§½å†…å®¹ **æ— æ³•è®¿é—®**å­ç»„ä»¶çš„æ•°æ®
>
> ä»»ä½•çˆ¶ç»„ä»¶æ¨¡æ¿ä¸­çš„ä¸œè¥¿éƒ½åªæ˜¯ç¼–è¯‘åˆ°çˆ¶ç»„ä»¶çš„ä½œç”¨åŸŸä¸­ï¼›è€Œä»»ä½•å­ç»„ä»¶æ¨¡æ¿ä¸­çš„ä¸œè¥¿éƒ½åªæ˜¯è¢«ç¼–è¯‘åˆ°å­ç»„ä»¶çš„ä½œç”¨åŸŸä¸­

1. é»˜è®¤å†…å®¹

   åœ¨çˆ¶ç»„ä»¶æ²¡æœ‰ç»™å­ç»„ä»¶æä¾›ä»»ä½•æ’æ§½å†…å®¹æ—¶ï¼Œå†™åœ¨`<slot>`æ ‡ç­¾ä¹‹é—´ï¼Œä½¿å…¶æˆä¸ºé»˜è®¤å†…å®¹

   ```html
   // å­ç»„ä»¶
   <button type="submit">
       <slot>
    		<!--é»˜è®¤å†…å®¹-->   
       </slot>
   </button>
   ```

2. åŠ¨æ€æ’æ§½å

3. ä½œç”¨åŸŸæ’æ§½

   [ä½œç”¨åŸŸæ’æ§½](https://staging-cn.vuejs.org/guide/components/slots.html#scoped-slots)

**ä¾èµ–æ³¨å…¥**

- ç¼–å†™æ’ä»¶ï¼Œæ’ä»¶ä¸€èˆ¬éƒ½ä¸ä¼šä½¿ç”¨ç»„ä»¶å½¢å¼æ¥æä¾›å€¼
- **`Symbol()` çš„ç”¨æ­¦ä¹‹åœ°ï¼Œä½¿ç”¨Symbolæ¥ä½œä¸ºæ³¨å…¥åä»¥é¿å…æ½œåœ¨çš„å†²çª**

#### å¼‚æ­¥ç»„ä»¶ï¼ˆå¾…ç»ƒä¹ ï¼‰

- å…¨å±€å¼‚æ­¥

  ```javascript
  import { defineAsyncComponent } from 'vue'
  
  const AsyncComp = defineAsyncComponent(() =>
    import('./components/MyComponent.vue')
  )
  ```

- **å±€éƒ¨æ³¨å†Œç»„ä»¶å¼‚æ­¥**

  > é«˜é¢‘é¡µé¢ï¼ŒåŠ è½½å±€éƒ¨ç»„ä»¶ï¼ˆå¯¼å‡ºexecl, å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ **ç™¾åº¦ ueditor**ï¼‰

  ```
  import { defineAsyncComponent } from 'vue'
  export default {
  	components: {
  		AsyncComponent: defineAsyncComponent(() => import ('./components/AsyncComponent.vue'))
  	}
  }
  ```

- åŠ è½½ä¸é”™è¯¯çŠ¶æ€

  [æ¡ˆä¾‹å±•ç¤º](https://staging-cn.vuejs.org/guide/components/async.html#loading-and-error-states)

- æ­é… Suspense ä½¿ç”¨
